# CLAUDE.md - 프로젝트 분석 및 설명

## 프로젝트 개요

**Kimchi Premium Strategy Implementation**은 한국 암호화폐 거래소와 해외 거래소 간의 가격 차이(김치 프리미엄)를 활용한 자동매매 시스템입니다. 이 프로젝트는 알트코인의 환율 차이를 실시간으로 모니터링하고, 적절한 타이밍에 자동으로 포지션을 진입/종료하는 전략을 구현합니다.

## 핵심 개념

### 김치 프리미엄이란?

- 같은 암호화폐가 국내 거래소에서 해외 거래소보다 높은 가격에 거래되는 현상
- **국내 거래소 가격 / 해외 거래소 가격**의 비율로 측정
- 환율, 정세, 군중심리 등의 영향으로 국제 환율을 이탈하는 경우 발생

### 투자 전략

- **국내 거래소**: 현물 매수 (선물 거래 제공하지 않음)
- **해외 거래소**: 선물 매도 (레버리지 활용 가능)
- 환율이 낮을 때 진입하여 환율이 높을 때 종료하는 차익거래

## 기술 스택

### Backend

- **언어**: Python 3.11+
- **프레임워크**: FastAPI
- **비동기 작업**: Celery
- **데이터베이스**: SQLAlchemy (PostgreSQL), SQLite3
- **캐시**: Redis
- **패키지 관리**: uv
- **스케줄링**: APScheduler

### Frontend

- **프레임워크**: React 19+
- **UI 라이브러리**: Material-UI (MUI)
- **빌드 도구**: Vite
- **언어**: TypeScript
- **HTTP 클라이언트**: Axios

### 인프라

- **클라우드**: AWS EC2
- **메시지 큐**: AWS SQS
- **캐시**: AWS ElastiCache (Redis)
- **모니터링**: Flower (Celery 모니터링)

## 프로젝트 구조

```
kimchi_premium_strategy_implementation/
├── backend/                    # 백엔드 API 서버
│   ├── core/                  # 핵심 비즈니스 로직
│   │   ├── ex_manager.py      # 거래소 관리자
│   │   ├── security.py        # 보안 관련
│   │   └── state.py           # 상태 관리
│   ├── db/                    # 데이터베이스 관련
│   │   ├── base.py           # DB 설정
│   │   ├── models/           # SQLAlchemy 모델
│   │   ├── repository/       # 데이터 접근 계층
│   │   └── schemas/          # Pydantic 스키마
│   ├── exchanges/             # 거래소 API 통합
│   │   ├── base.py           # 추상 클래스
│   │   ├── upbit.py          # 업비트 (국내)
│   │   ├── bybit.py          # 바이비트 (해외)
│   │   ├── binance.py        # 바이낸스
│   │   └── ...               # 기타 거래소
│   ├── routers/              # FastAPI 라우터
│   ├── services/             # 비즈니스 서비스 로직
│   └── utils/                # 유틸리티 함수
├── frontend/                  # React 프론트엔드
│   ├── src/
│   │   ├── components/       # React 컴포넌트
│   │   └── ...
├── consumer.py               # Celery 워커 (핵심 거래 로직)
├── scheduler.py              # 스케줄러 (데이터 갱신)
├── main.py                   # FastAPI 메인 애플리케이션
└── tests/                    # 테스트 코드
```

## 핵심 컴포넌트

### 1. ExchangeManager (`backend/core/ex_manager.py`)

- 여러 거래소를 통합 관리
- 공통 티커 목록 생성
- 데이터베이스 CRUD 작업
- 포지션 관리 및 정산

### 2. Exchange 추상화 (`backend/exchanges/`)

- `Exchange`: 모든 거래소의 기본 인터페이스
- `KoreanExchange`: 국내 거래소 (현물 거래)
- `ForeignExchange`: 해외 거래소 (선물 거래 + 레버리지)

### 3. Consumer (`consumer.py`) - 핵심 거래 로직

```python
@app.task(name='producer.calculate_orderbook_exrate_task')
def work_task(data, korean_ex, foreign_ex, retry_count=0):
```

- **실시간 환율 계산**: 호가창 기반으로 실제 거래 가능한 환율 계산
- **포지션 진입**: 설정된 조건에 맞을 때 자동 매수/매도
- **포지션 종료**: 목표 수익률 달성 시 자동 청산
- **리스크 관리**: 잔액 확인, 진입 횟수 제한 등

### 4. Scheduler (`scheduler.py`)

- **티커 목록 갱신**: 5분마다 거래 가능한 코인 목록 업데이트
- **큐 관리**: 매분마다 SQS에 작업 큐 생성
- **입출금 상태 확인**: 업비트 코인 입출금 가능 여부 모니터링

## 주요 기능

### 자동매매 시스템

1. **실시간 모니터링**: 131개 공통 티커의 실시간 환율 감시
2. **자동 진입**: 테더 가격 대비 저평가 시 자동 포지션 진입
3. **자동 종료**: 목표 수익률 달성 시 자동 포지션 청산
4. **피라미딩**: 분할 매수를 통한 리스크 분산

### 관리자 UI 기능

- **티커 선택**: Autocomplete를 통한 모니터링 대상 선택
- **환율 차트**: 선택된 코인의 실시간 환율 시각화
- **시드 설정**: 거래 금액 및 분할 횟수 설정
- **진입/종료 조건**: 진입 및 종료 환율 설정
- **실시간 손익**: WebSocket을 통한 실시간 P&L 표시
- **거래 내역**: 매매 이력 조회 및 분석

### 리스크 관리

- **슬리피지 고려**: 호가창 기반 실제 거래 가능 가격 계산
- **잔액 검증**: 거래 전 충분한 잔액 확인
- **입출금 체크**: 가두리 양식장 코인 필터링
- **포지션 제한**: 사용자별 최대 진입 횟수 제한

## 성능 최적화

### API Rate Limit 관리

- **업비트**: 초당 30회 제한
- **바이비트**: 초당 120회 제한
- **분산 처리**: 5개 이상의 워커 인스턴스로 부하 분산

### 캐싱 전략

- **USDT 가격**: 1초 캐시를 통한 API 호출 최적화
- **Redis**: 실시간 데이터 캐싱 및 세션 관리

### 비동기 처리

- **Celery**: 백그라운드 작업 처리
- **AsyncIO**: 비동기 API 호출 최적화

## 데이터 모델

### 주요 테이블

- **exchanges**: 거래소 정보
- **tickers**: 티커 목록 및 거래 가능 여부
- **users**: 사용자 정보 및 설정
- **strategies**: 거래 전략 설정
- **positions**: 포지션 정보 및 거래 내역

## 보안 고려사항

### API 키 관리

- 환경 변수를 통한 안전한 키 저장
- 거래소별 API 권한 최소화

### 데이터 검증

- 입력 데이터 검증 및 sanitization
- SQL Injection 방지
- CORS 설정

## 모니터링 및 로깅

### 로깅 시스템

- YAML 기반 로깅 설정
- 레벨별 로그 관리 (DEBUG, INFO, WARNING, ERROR)
- 파일 로테이션 및 보관

### 텔레그램 알림

- 거래 체결 시 실시간 알림
- 에러 발생 시 즉시 알림
- 수익 실현 시 상세 정보 전송

## 테스트 전략

### 테스트 범위

- **단위 테스트**: 각 거래소 API 테스트
- **통합 테스트**: 전체 거래 플로우 테스트
- **E2E 테스트**: 실제 거래소 연동 테스트

## 향후 개선 사항

### AI 적용

- 기계학습을 통한 진입/종료 시점 최적화
- 시장 상황 분석을 통한 동적 전략 조정

### 확장성

- 추가 거래소 지원
- 다양한 거래 전략 구현
- 포트폴리오 관리 기능

### 사용자 경험

- 모바일 앱 개발
- 고급 차트 기능
- 소셜 트레이딩 기능

## 주의사항

### 리스크 요소

1. **환율 리스크**: 원/달러 환율 변동에 따른 손실 가능성
2. **유동성 리스크**: 시장 상황에 따른 거래 체결 실패
3. **기술적 리스크**: 시스템 장애 또는 API 오류
4. **규제 리스크**: 암호화폐 관련 법규 변경

### 운영 시 고려사항

- 충분한 테스트 후 실거래 적용
- 초기에는 소액으로 운영
- 정기적인 시스템 점검 및 업데이트
- 시장 상황 모니터링 및 전략 조정

## 결론

이 프로젝트는 암호화폐 시장의 김치 프리미엄 현상을 활용한 체계적이고 자동화된 거래 시스템입니다. Python/FastAPI 기반의 견고한 백엔드와 React 기반의 직관적인 프론트엔드, 그리고 AWS 인프라를 활용한 확장 가능한 아키텍처를 통해 안정적이고 효율적인 암호화폐 자동매매를 구현했습니다.

특히 실시간 데이터 처리, 리스크 관리, 성능 최적화 등을 고려한 설계로 실제 운영 환경에서의 안정성을 확보했으며, 지속적인 개선과 확장이 가능한 구조로 개발되었습니다.
