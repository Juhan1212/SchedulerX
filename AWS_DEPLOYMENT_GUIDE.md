# AWS EC2 ë°°í¬ ê°€ì´ë“œ

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Scheduler     â”‚    â”‚    Worker 1     â”‚    â”‚    Worker N     â”‚
â”‚   Instance      â”‚    â”‚   Instance      â”‚    â”‚   Instance      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Redis       â”‚â—„â”œâ”€â”€â”€â”€â”¤ â”‚ Celery      â”‚ â”‚    â”‚ â”‚ Celery      â”‚ â”‚
â”‚ â”‚ RabbitMQ    â”‚â—„â”œâ”€â”€â”€â”€â”¤ â”‚ Worker      â”‚ â”‚    â”‚ â”‚ Worker      â”‚ â”‚
â”‚ â”‚ Scheduler   â”‚ â”‚    â”‚ â”‚             â”‚ â”‚    â”‚ â”‚             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   RDS PostgreSQL â”‚
                    â”‚    Database      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ ë°°í¬ ë‹¨ê³„

### 1ë‹¨ê³„: RDS PostgreSQL ì¸ìŠ¤í„´ìŠ¤ ìƒì„±

1. AWS RDS ì½˜ì†”ì—ì„œ PostgreSQL ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
2. Free Tier í…œí”Œë¦¿ ì„ íƒ
3. DB ì¸ìŠ¤í„´ìŠ¤ ì‹ë³„ì: `kimchi-premium-db`
4. ë§ˆìŠ¤í„° ì‚¬ìš©ìëª…: `admin`
5. ë³´ì•ˆ ê·¸ë£¹ì—ì„œ 5432 í¬íŠ¸ ê°œë°© (EC2 ì¸ìŠ¤í„´ìŠ¤ë“¤ë§Œ ì ‘ê·¼)

### 2ë‹¨ê³„: ìŠ¤ì¼€ì¤„ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ë°°í¬

```bash
# EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒì„± í›„ ìŠ¤ì¼€ì¤„ëŸ¬ ë°°í¬
chmod +x deploy-scheduler.sh
./deploy-scheduler.sh
```

**ìŠ¤ì¼€ì¤„ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ì„¤ì •:**

- ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…: `t3.small` ì´ìƒ ê¶Œì¥ (Redis + RabbitMQ ìš´ì˜)
- ë³´ì•ˆ ê·¸ë£¹: 6379 (Redis), 5672 (RabbitMQ), 15672 (RabbitMQ Management) í¬íŠ¸ ê°œë°©
- ìŠ¤í† ë¦¬ì§€: 20GB ì´ìƒ

### 3ë‹¨ê³„: Worker ì¸ìŠ¤í„´ìŠ¤ë“¤ ë°°í¬

```bash
# ê° Worker EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‹¤í–‰
chmod +x deploy.sh
./deploy.sh
```

**Worker ì¸ìŠ¤í„´ìŠ¤ ì„¤ì •:**

- ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…: `t3.micro` (Free Tier ê°€ëŠ¥)
- ë³´ì•ˆ ê·¸ë£¹: ì•„ì›ƒë°”ìš´ë“œ 6379, 5672 í¬íŠ¸ í—ˆìš©
- ìŠ¤í† ë¦¬ì§€: 8GB (ê¸°ë³¸ê°’)

### 4ë‹¨ê³„: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

#### ìŠ¤ì¼€ì¤„ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ (.env):

```env
REDIS_HOST=localhost
RABBITMQ_HOST=localhost
DATABASE_URL=postgresql://admin:YOUR_RDS_PASSWORD@your-rds-endpoint.amazonaws.com:5432/postgres
# ... ê¸°íƒ€ í™˜ê²½ë³€ìˆ˜
```

#### Worker ì¸ìŠ¤í„´ìŠ¤ë“¤ (.env):

```env
REDIS_HOST=SCHEDULER_INSTANCE_PRIVATE_IP
RABBITMQ_HOST=SCHEDULER_INSTANCE_PRIVATE_IP
DATABASE_URL=postgresql://admin:YOUR_RDS_PASSWORD@your-rds-endpoint.amazonaws.com:5432/postgres
# ... ê¸°íƒ€ í™˜ê²½ë³€ìˆ˜
```

## ğŸš€ ì„œë¹„ìŠ¤ ì‹œì‘

### ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘:

```bash
sudo systemctl start kimchi-scheduler
sudo systemctl status kimchi-scheduler
```

### Workerë“¤ ì‹œì‘:

```bash
sudo systemctl start kimchi-celery-worker
sudo systemctl status kimchi-celery-worker
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§

### ë¡œê·¸ í™•ì¸:

```bash
# ìŠ¤ì¼€ì¤„ëŸ¬ ë¡œê·¸
sudo journalctl -u kimchi-scheduler -f

# Worker ë¡œê·¸
sudo journalctl -u kimchi-celery-worker -f
```

### RabbitMQ ê´€ë¦¬ UI:

- URL: `http://SCHEDULER_PUBLIC_IP:15672`
- ê³„ì •: `celery` / `123`

### Redis ëª¨ë‹ˆí„°ë§:

```bash
# ìŠ¤ì¼€ì¤„ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ
redis-cli info
redis-cli monitor
```

## ğŸ”’ ë³´ì•ˆ ì„¤ì •

### ë³´ì•ˆ ê·¸ë£¹ ì„¤ì •:

#### ìŠ¤ì¼€ì¤„ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ë³´ì•ˆ ê·¸ë£¹:

- **ì¸ë°”ìš´ë“œ:**
  - 6379/tcp: Worker ì¸ìŠ¤í„´ìŠ¤ë“¤ë§Œ ì ‘ê·¼
  - 5672/tcp: Worker ì¸ìŠ¤í„´ìŠ¤ë“¤ë§Œ ì ‘ê·¼
  - 15672/tcp: ê´€ë¦¬ì IPë§Œ ì ‘ê·¼ (RabbitMQ Management UI)
  - 22/tcp: ê´€ë¦¬ì IPë§Œ ì ‘ê·¼ (SSH)

#### Worker ì¸ìŠ¤í„´ìŠ¤ ë³´ì•ˆ ê·¸ë£¹:

- **ì•„ì›ƒë°”ìš´ë“œ:**
  - 6379/tcp: ìŠ¤ì¼€ì¤„ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ë¡œ
  - 5672/tcp: ìŠ¤ì¼€ì¤„ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ë¡œ
  - 5432/tcp: RDSë¡œ
  - 443/tcp: ì™¸ë¶€ API í˜¸ì¶œìš©

#### RDS ë³´ì•ˆ ê·¸ë£¹:

- **ì¸ë°”ìš´ë“œ:**
  - 5432/tcp: ëª¨ë“  EC2 ì¸ìŠ¤í„´ìŠ¤ë“¤ë§Œ ì ‘ê·¼

## ğŸ’° ë¹„ìš© ìµœì í™”

### Free Tier í™œìš©:

- RDS: `db.t3.micro` (12ê°œì›” ë¬´ë£Œ)
- EC2: `t3.micro` Ã— 4ê°œ (ê°ê° 750ì‹œê°„/ì›” ë¬´ë£Œ)
- ì´ ì˜ˆìƒ ë¹„ìš© (12ê°œì›” í›„): ì›” $30-40

### ë¹„ìš© ì ˆì•½ íŒ:

1. Worker ì¸ìŠ¤í„´ìŠ¤ëŠ” í•„ìš” ì‹œì—ë§Œ í™•ì¥
2. CloudWatchë¡œ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
3. ì•¼ê°„ ì‹œê°„ëŒ€ ì¸ìŠ¤í„´ìŠ¤ ìŠ¤ì¼€ì¼ ë‹¤ìš´ ê³ ë ¤

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì—°ê²° ë¬¸ì œ:

```bash
# Redis ì—°ê²° í…ŒìŠ¤íŠ¸
redis-cli -h SCHEDULER_IP ping

# RabbitMQ ì—°ê²° í…ŒìŠ¤íŠ¸
curl -u celery:123 http://SCHEDULER_IP:15672/api/overview

# PostgreSQL ì—°ê²° í…ŒìŠ¤íŠ¸
psql -h RDS_ENDPOINT -U admin -d postgres
```

### ì„œë¹„ìŠ¤ ì¬ì‹œì‘:

```bash
# ì „ì²´ ìŠ¤íƒ ì¬ì‹œì‘ (ìŠ¤ì¼€ì¤„ëŸ¬ì—ì„œ)
sudo systemctl restart redis-server
sudo systemctl restart rabbitmq-server
sudo systemctl restart kimchi-scheduler

# Worker ì¬ì‹œì‘ (ê° Worker ì¸ìŠ¤í„´ìŠ¤ì—ì„œ)
sudo systemctl restart kimchi-celery-worker
```

## ğŸ“ˆ í™•ì¥ì„±

### Worker ì¸ìŠ¤í„´ìŠ¤ ì¶”ê°€:

1. ìƒˆ EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
2. `deploy.sh` ì‹¤í–‰
3. í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ìŠ¤ì¼€ì¤„ëŸ¬ IP ì…ë ¥)
4. Worker ì„œë¹„ìŠ¤ ì‹œì‘

### ëª¨ë‹ˆí„°ë§ ì¶”ê°€:

- CloudWatchë¡œ EC2 ë©”íŠ¸ë¦­ ëª¨ë‹ˆí„°ë§
- RabbitMQ í ê¸¸ì´ ëª¨ë‹ˆí„°ë§
- Redis ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
